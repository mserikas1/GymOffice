<AuthorizeView>
    <Authorized>
        <MudNavMenu>
            @if (CurrentUserRole == "Admin")
            {
                <AdminNavMenu />
            }
            @if (CurrentUserRole == "Coach")
            {
                <CoachNavMenu />
            }
            @if (CurrentUserRole == "Receptionist")
            {
                <ReceptionistNavMenu />
            }
        </MudNavMenu>
    </Authorized>
    <NotAuthorized>
        @*Show no menu*@
    </NotAuthorized>
</AuthorizeView>

@code {
    [Inject] UserManager<IdentityUser> UserManager { get; set; } = null!;
    
    [CascadingParameter]
    private Task<AuthenticationState>? authenticationStateTask { get; set; }

    string CurrentUserRole { get; set; } = string.Empty;

    protected async Task<string> GetCurrenUserRole()
    {
        var User = (await authenticationStateTask!).User;
        if (User == null)
            return ""; // most probably, cookies are not set or a user was never logged in
        if (!User.Identity!.IsAuthenticated)  // or if (!SignInManager.IsSignedIn(User))
            return "";
        IdentityUser currentUser = await UserManager.GetUserAsync(User);
        IList<string> roles = await UserManager.GetRolesAsync(currentUser);
        return roles.FirstOrDefault() ?? "Undefined";
    }

    protected override async Task OnInitializedAsync()
    {
        if (CurrentUserRole == "")
            CurrentUserRole = await GetCurrenUserRole();
    }
}
